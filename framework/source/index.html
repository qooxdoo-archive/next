<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>qxWeb source</title>
  <style type="text/css" media="screen">
  body > div {
    padding: 0 40px;
  }

  .hidden {
    display: none;
  }

  .red {
    color: red;
  }

  .underline {
    text-decoration: underline;
  }

  </style>
  <link rel="stylesheet" type="text/css" href="../build/resource/qx/css/indigo.css">
  <script type="text/javascript" src="script/q-source.js"></script>
  <script type="text/javascript">
    q.ready(function() {
      qx.module.Application.grayscale = function(data) {
        if (data) {
          var r = parseInt(data.substring(1, 3), 16);
          var g = parseInt(data.substring(3, 5), 16);
          var b = parseInt(data.substring(5, 7), 16);

          var val = ((Math.max(r, g, b) + Math.min(r, b, g)) / 2).toString(16);

          if (val.length == 1) {
            val = "0" + val;
          }

          data = "#" + val + val + val;
        }
        return data;
      };

      qx.module.Application.reverse = function(data) {
        if (data) {
          data.reverse();
        }
        return data;
      };

      app = q(document.body).app();

      app.taptap =  function(evt, el) {
        el.setStyle("color", "red");
      };

      app.postfix = "!!!";
      app.test = qx.data.marshal.Json.createModel({name: "model value"});

      app.listModel = new qx.data.Array(["a", "b", "c"]);

      // JSON loading
      var store = new qx.data.store.Json("resource/qx/test/primitive.json");
      app.addModel("primitive", null),
      qx.data.SingleValueBinding.bind(store, "model", app, "primitive");

      // binding of inhomogen structures, maybe using a silent fail option of the SingleValueBinding
      // TODO control over binding direction (no two way binding e.g.)
    });
  </script>
</head>
<body>

  <div>
    <h3>Events</h3>
    <div data-event="tap -> taptap()">Tap</div>
    <div data-event="tap -> taptap()">Tap</div>
    <div data-event="tap -> taptap()">Tap</div>
  </div>

  <div>
    <h3 data-bind="underline {{classname}} -> class">Class name from model</h3>
    <input data-bind="{{classname}} <-> value" placeholder="e.g. red">
  </div>

  <div>
    <h3>Repeat</h3>
    <ul data-repeat="{{listModel}}">
      <li data-bind="{{listModel[$index]}} -> html; {{mycolor}} -> style.color;"></li>
    </ul>
  </div>

  <div>
    <h3>Not</h3>
    <input type="checkbox" data-bind="{{x}} <-> checked">
    <span data-bind="{{x}} -> html"></span> !=
    <span data-bind="{{not(x)}} -> html"></span>
  </div>

  <div>
    <h3>Only app code required</h3>
    <input
      data-bind="{{mycolor}} <-> value;
                 {{mycolor}} -> style.color;
                 {{slider}}px -> style.font-size;"
      value="red"
      placeholder="type in text color">
  </div>


  <div>
    <h3>Bidirectional binding</h3>
    <input data-bind="{{test.name}} <-> value;">
    <span data-bind="{{test.name}}{{postfix}} -> html"></span>
  </div>


  <div>
    <h3>Show / Hide / Enabled</h3>
    <label>hide <input type="checkbox" data-bind="{{hidden}} <-> checked"></label>
    <label>disabled <input type="checkbox" data-bind="{{enabled}} <-> checked"></label>
    <input type="text" data-bind="{{hidden}} -> class.hidden; {{enabled}} -> disabled" value="test">
  </div>


  <div>
    <h3>Select</h3>
    <select data-repeat="{{listModel}}" data-bind="{{selected}} <-> value">
      <option data-bind="{{listModel[$index]}} -> html;">AFFE</option>
    </select>
    <span data-bind="Selected: {{selected}} -> html"></span>
  </div>


  <div>
    <h3>Widget Binding</h3>
    <div data-qx-widget="qx.ui.form.Slider"
      data-bind="{{slider}} <-> data-qx-config-value"
      data-qx-config-value="22"></div>
    <p data-bind="The slider value is {{slider}}. -> html"></p>
    <div
      data-qx-widget="qx.ui.List"
      data-bind="{{reverse(listModel)}} -> data-qx-config-model"></div>
    <p data-bind="{{not(listModel.length)}} -> class.hidden">
      # <span data-bind="{{listModel.length}} -> html"></span> Items in the list
    </p>
  </div>

  <div>
    <h3>Load via Json Store</h3>
    <p data-bind="{{primitive.string}} -> html"></p>
    <p data-bind="{{primitive.number}} -> html"></p>
    <p data-bind="{{primitive.boolean}} -> html"></p>
  </div>


  <div>
    <h3 data-bind="{{grayscale(customColor)}} -> style.color">Color to grayscale</h3>
    <input type="color" data-bind="{{customColor}} <-> value">
  </div>

</body>
</html>